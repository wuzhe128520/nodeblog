!function(){$("#say").emoji({button:"#btn",icons:[{name:"QQ表情",path:"/js/plugin/emoji/img/qq/",maxNum:104,file:".gif",placeholder:"#qq_{alias}#",title:{1:"微笑",2:"撇嘴",3:"色",4:"发呆",5:"得意",6:"流泪",7:"害羞",8:"闭嘴",9:"睡",10:"大哭",11:"尴尬",12:"发怒",13:"调皮",14:"龇牙",15:"惊讶",16:"难过",17:"酷",18:"冷汗",19:"抓狂",20:"吐",21:"偷笑",22:"可爱",23:"白眼",24:"傲慢",25:"饥饿",26:"困",27:"惊恐",28:"流汗",29:"憨笑",30:"大兵",31:"奋斗",32:"咒骂",33:"疑问",34:"嘘",35:"晕",36:"折磨",37:"衰",38:"骷髅",39:"敲打",40:"再见",41:"擦汗",42:"抠鼻",43:"鼓掌",44:"糗大了",45:"坏笑",46:"左哼哼",47:"右哼哼",48:"哈欠",49:"鄙视",50:"委屈",51:"快哭了",52:"阴险",53:"亲亲",54:"吓",55:"可怜",56:"眨眼睛",57:"笑哭",58:"doge",59:"泪奔",60:"无奈",61:"托腮",62:"卖萌",63:"斜眼笑",64:"喷血",65:"惊喜",66:"骚扰",67:"小纠结",68:"我最美",69:"啤酒",70:"咖啡",71:"饭",72:"猪",73:"玫瑰",74:"凋谢",75:"示爱",76:"爱心",77:"心碎",78:"蛋糕",79:"闪电",80:"炸弹",81:"刀",82:"菜刀",83:"足球",84:"瓢虫",85:"便便",86:"拥抱",87:"强",88:"弱",89:"握手",90:"胜利",91:"抱拳",92:"勾引",93:"拳头",94:"差劲",95:"爱你",96:"no",97:"ok",98:"跳跳",99:"发抖",100:"怄火",101:"磕头",102:"回头",103:"激动",104:"街舞"}}]});var uploader=WebUploader.create({auto:!1,swf:"../ueditor/third-party/webuploader/Uploader.swf",server:"/multiUpload",pick:"#filePicker",fileNumLimit:9,accept:{title:"Images",extensions:"jpg,jpeg,png",mimeTypes:"image/jpg,image/jpeg,image/png"}});uploader.on("fileQueued",function(e){var i=$('<div id="'+e.id+'" class="file-item thumbnail"><div class="func clearfix"><i class="iconfont icon-shanchu delete remove-this"></i></div><img><div class="info">'+e.name+"</div></div>"),n=$(".uploader-list"),a=i.find("img");n.append(i),uploader.makeThumb(e,function(e,i){if(e)return void a.replaceWith("<span>不能预览</span>");a.attr("src",i)},"220","220"),i.on("click",".remove-this",function(){uploader.removeFile(e),$("#"+e.id).remove()})}),uploader.on("uploadProgress",function(e,i){var n=$("#"+e.id),a="",o=n.find(".progress span");o.length||(o=$('<p class="progress"><span></span></p>').appendTo(n).find("span")),a=100*i+"%",o.css("width",a).find("span").end().text(a)});var imgUrls=[],isFinished=!1;uploader.on("uploadSuccess",function(file,response){var jsonToObject=eval("("+response._raw+")"),originUrl=jsonToObject.imgurl,newUrl=originUrl.replace(/\\/g,"/"),imgstr='<img src="'+newUrl+'" alt="" />';imgUrls.push(imgstr),$("#"+file.id).addClass("upload-state-done")}),uploader.on("uploadError",function(e){var i=$("#"+e.id),n=i.find("div.error");n.length||(n=$('<div class="error"></div>').appendTo(i)),n.text("上传失败")}),uploader.on("uploadComplete",function(e){}),uploader.on("uploadFinished",function(){isFinished=!0}),$("#declare-say-btn").on("click",function(){}),$("#declare-say-btn").on("click",function(){var e=$("#say").html(),i="",n=!1;if($("#fileList").find("img").length>0){uploader.upload();var a=setInterval(function(){isFinished&&(i=imgUrls.join(""),n=!0,clearInterval(a))},1e3)}else n=!0;var o=setInterval(function(){n&&(comm.ajax.commAjax({url:"/admin/writesay",type:"post",data:{content:e,imgs:i},successFn:function(e){1===e.status&&comm.layer.alert(e.des,function(e){window.location.replace("/say")})},errorFn:function(e){comm.layer.alert(e)}}),clearInterval(o))},2e3)})}();