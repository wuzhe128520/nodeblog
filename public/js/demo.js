function init(){cropper=new ImageCropper(500,500,180,180),cropper.setCanvas("Tz_wrap"),cropper.addPreview("preview180"),cropper.isAvaiable()||alert("您的浏览器并不支持图像剪裁"),$("body").on({dragenter:function(e){e=e||window.event,e.preventDefault(),e.stopPropagation()},dragleave:function(e){e=e||window.event,e.preventDefault(),e.stopPropagation()},dragover:function(e){e=e||window.event,e.preventDefault(),e.stopPropagation()},drop:function(e){e=e||window.event,e.preventDefault(),e.stopPropagation()}})}function drag(){$Tz_wrap.get(0).ondrop=function(e){e.preventDefault();var t=e.dataTransfer.files;if(-1!=t[0].type.indexOf("image")){var a=new FileReader;cropper.loadImage(t[0]),$(".ptit").css({zIndex:-1}),a.readAsDataURL(t[0])}}}function oper(){function e(e){cropper.loadImage(e[0])}$upLoad.click(function(){$input.click()}),$input.click(function(){$(this).change(function(){$(".ptit").css({zIndex:-1}),e(this.files)})}),$rL.click(function(){cropper.rotate(-90)}),$rR.click(function(){cropper.rotate(90)}),$send.click(function(){imgData=cropper.getCroppedImageData(180,180),$("#imgg").attr("src",imgData),console.log("上传了："+imgData),$.ajax({url:"/fs",type:"post",data:{data:imgData},success:function(e){e&&alert("图像上传成功！")}})})}var $Tz_wrap=$("#Tz_wrap"),$upLoad=$("#upload"),$send=$("#send"),$input=$("#input"),$rR=$("#rotateRightBtn"),$rL=$("#rotateLeftBtn"),cropper;init(),drag(),oper();