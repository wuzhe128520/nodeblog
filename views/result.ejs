<%include header.ejs%>
<script>
    loadStaticFile('/css/index.css');
</script>
<main>
    <div class="main clearfix">
        <div class="article-list-wrap js_list" id="articles">

        </div>
        <div id="pages"></div>
    </div>

</main>
<input type="hidden" value="<%=locals.typeid%>" id="typeid"/>

<%include footer.ejs%>
<script type="text/template" id="template">
    <div class="pages">
        <ul class="page-wrap">
            <$
            //每页显示几条数据
            var  showPageNum = parseInt(pages.showPageNum),
            //总页数
            totalPage = Math.ceil(pages.allPageNum/showPageNum),
            //当前页
            currentPage = parseInt(pages.currentPage);
            $>

            <li class="page">
                <span><$= currentPage $>/<$= totalPage $></span>
            </li>

            <$ if(currentPage!== 1){ $>
            <li class="page">
                <a href="javascript:void(0);">
                    <
                </a>
            </li>
            <$ } $>

            <$
            for(var i = 0;i < totalPage ;i++){
            //循环中的当前页码
            var loopPage = i + 1;
            $>

            <li class="page">
                <a  <$ if(loopPage === currentPage) { $>
                class="active" href="javascript:void(0);"
                <$ } else { $>
                href="javascript:void(0);"
                <$ } $>
                >
                <$= loopPage $>
                </a>
            </li>

            <$}$>

            <$if(currentPage !== totalPage){$>

            <li class="page">
                <a href="javascript:void(0);">
                    >
                </a>
            </li>
            <li class="page">
                <a href="javascript:void(0);">尾页</a>
            </li>
            <$}$>
        </ul>
    </div>
</script>
<script type="text/template" id="articleTmpl">
    <!--文章列表begin-->
    <$
       var i = 0,
           length = data.length;
       for(; i < length; i++){
    $>
    <section>
        <div class="article js_article" data-articleid ='<$=data[i].id$>'>
            <h2 class="article-title">
                <a href="/article-detail/<$=data[i].id$>.html" title="文章标题" class="js_article_title"><$=data[i].title$></a>
            </h2>
            <article>
                <div class="article-summary-wrap">
                    <$if(data[i].img){$>
                    <a href="/article-detail/<$=data[i].id$>.html" class="article-img-wrap">
                        <img src="<$=data[i].img$>" />
                    </a>
                    <$}$>
                    <p class="article-content">
                        <$=data[i].summery$>
                    </p>
                    <a href="/article-detail/<$=data[i].id$>.html" class="read-more">阅读全文</a>
                </div>
            </article>
            <footer>
                <div class="article-footer-wrap">
                        <span>
                            <a href="javascript:void(0);" class="iconfont-wrap">
                                <i title="日期图标" class="iconfont icon-time"></i>
                                <time><$=data[i].time$></time>
                            </a>
                        </span>
                    <span>
                                <a href="javascript:void(0);" class="iconfont-wrap">
                                    <i title="浏览量图标" class="iconfont icon-eye"></i>
                                    浏览<$=data[i].views|0$>次
                                </a>
                        </span>
                    <span>
                                <a href="javascript:void(0);" class="iconfont-wrap js_ding">
                                    <i title="顶一个图标" class="iconfont icon-ding" ></i>
                                    顶(<span class="js_ding_text"><$=data[i].ding|0$></span>)
                                </a>
                        </span>
                    <span>
                                <a href="javascript:void(0);" class="iconfont-wrap js_cai">
                                        <i title="踩一个图标" class="iconfont icon-iconfontcai js_cai"></i>
                                        踩(<span class="js_cai_text"><$=data[i].cai|0$></span>)
                                </a>
                        </span>
                    <span>
                                <a href="/article-detail/<$=data[i].id$>.html#commentsArea" class="iconfont-wrap">
                                    <i title="评论图标" class="iconfont icon-comments"></i>
                                    评论(<$=data[i].comment_count|0$>)
                                </a>
                        </span>
                    <!--分类-->
                    <span class="article-type">
                            分类:[<a href="/type/<$= data[i].typeid $>.html" class=""><$=data[i].typename $></a>]
                        </span>
                    <!--分类-->
                </div>
            </footer>
        </div>
    </section>
    <$}$>
    <!--文章列表end-->

</script>
<script type="text/javascript">
    $(init);
    function init() {

        $('.js_list').css('width','100%');

        //使用分页组件
        comm.page.init({
            url: '/type',
            $container: $('#pages'),
            pageTmplId: 'template',
            dataTmplId: 'articleTmpl',
            dataId: 'articles',
            postData: {
                currentPage: 1,
                showPageNum: 5,
                typeid: parseInt($('#typeid').val())
            }
        });

        function handleClick() {
            var $target = $(this);
            var articleId = $target.closest('.js_article').data('articleid');
            ding($target,articleId);
        }
        $("#articles").on('click','.js_ding',handleClick);
        //顶的业务逻辑
        function ding($self,articleId) {
            comm.ajax.commAjax({
                url: '/ding',
                type: 'post',
                data: {id: articleId},
                errorFn: function(error){
                    comm.layer.msg('顶操作失败！');
                },
                successFn: function(data){
                    $self.find('.js_ding_text').text(data.dm[0].ding);
                }
            });

        }
        function handleCaiClick() {
            var $target = $(this);
            var articleId = $target.closest('.js_article').data('articleid');
            cai($target,articleId);
        }
        $("#articles").on('click','.js_cai',handleCaiClick);

        //踩的业务逻辑
        function cai($self,articleId) {
            comm.ajax.commAjax({
                url: '/cai',
                type: 'post',
                data: {id: articleId},
                errorFn: function(error){
                    comm.layer.msg('踩失败！');
                },
                successFn: function(data){
                    $self.find('.js_cai_text').text(data.c[0].cai);
                }
            });
        }


    };
    window._bd_share_config={
        "common":{
            "bdSnsKey":{},
            "bdText":"",
            "bdMini":"2",
            "bdPic":"",
            "bdStyle":"0",
            "bdSize":"24"
        },
        "share":{},
        "image":{
            "viewList":["qzone","tsina","tqq","renren","weixin"],
            "viewText":"分享到：",
            "viewSize":"16"
        }
    };
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];

</script>
</body>
</html>